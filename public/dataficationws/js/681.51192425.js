"use strict";(self["webpackChunkdatafication"]=self["webpackChunkdatafication"]||[]).push([[681],{29681:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var l=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"dataForm",staticStyle:{width:"100%",height:"50vh","overflow-y":"scroll"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"100px"}},[t("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.tableData,"row-key":"id",border:"","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"jdName",label:"名称",width:"320"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-row",{attrs:{type:"flex",align:"middle"}},[r.row.jdGrade>1?t("el-col",{staticClass:"line-el-col-expand",attrs:{span:2}},[t("span",{staticClass:"line-el-col-expand-top"}),t("span",{staticClass:"line-el-col-expand-conter"})]):e._e(),r.row.jdGrade<3?t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{size:"mini",type:"primary",circle:"",icon:"el-icon-plus"},on:{click:function(t){return e.buttonReset(r.row)}}})],1):e._e(),0==r.row.jdGrade||r.row.is?t("el-col",{attrs:{span:18}},[t("el-input",{staticStyle:{width:"100%"},attrs:{disabled:!0},model:{value:r.row.jdName,callback:function(t){e.$set(r.row,"jdName",t)},expression:"scope.row.jdName"}})],1):t("el-col",{attrs:{span:18}},[t("el-input",{staticStyle:{width:"100%"},attrs:{controls:!1},nativeOn:{"!blur":function(t){return e.addblur(r.row)}},model:{value:r.row.jdName,callback:function(t){e.$set(r.row,"jdName",t)},expression:"scope.row.jdName"}})],1)],1)]}}])}),t("el-table-column",{attrs:{prop:"jdParent",label:"上级"}}),t("el-table-column",{attrs:{prop:"rules",label:"权限"}}),t("el-table-column",{attrs:{label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(r){return 0!=r.row.jdGrade?[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(r.row)}}},[e._v("权限")]),1!=r.row.is?t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.updatascope(r.row)}}},[e._v("删除")]):e._e()]:void 0}}],null,!0)})],1),t("el-dialog",{attrs:{title:"页面权限",visible:e.dialogVisibletree,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisibletree=t}}},[t("el-form-item",{attrs:{label:"名称",prop:"title"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.title,callback:function(t){e.$set(e.temp,"title",t)},expression:"temp.title"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{model:{value:e.temp.status,callback:function(t){e.$set(e.temp,"status",t)},expression:"temp.status"}},[t("el-radio",{attrs:{label:1}},[e._v("正常")]),t("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1),t("el-form-item",{attrs:{label:"权限"}},[t("el-tree",{ref:"tree",attrs:{data:e.getRulesList,"default-checked-keys":e.defaultChecked,props:e.defaultProps,"default-expand-all":"","show-checkbox":"","check-strictly":"","node-key":"id"},on:{check:e.checkHandle}})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisibletree=!1}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.btnLoading,type:"primary"},on:{click:function(t){return e.saveDataTree()}}},[e._v("确定")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.btnLoading,type:"primary"},on:{click:function(t){return e.saveData()}}},[e._v("保存")])],1)],1)],1)},n=[],i=(r(57658),r(63822)),a=r(94053),d=r(92923),s=r(57801),o=(r(84722),{name:"RolesFormList",data(){return{btnLoading:!1,ruleList:[],temp:{id:0,jdName:"",status:1,rules:""},dialogFormVisible:!1,dialogVisibletree:!1,dialogStatus:"",textMap:{update:"编辑",create:"添加"},rules:{},defaultChecked:[],defaultProps:{children:"children",label:"title"},rowkey:0,tableobj:{},tableData:[]}},computed:{...(0,i.Se)(["group","code"]),getRulesList(){return s.Z.listToTreeMulti(this.ruleList)}},watch:{dialogFormVisible:function(){this.resetTemp()}},created(){this.getRules()},mounted(){},destroyed(){},methods:{addblur(e){if(""==e.jdName)return!1;let t=this.tableData[0].children;if(1==e.jdGrade)this.addalertaddblur(t);else if(2==e.jdGrade||3==e.jdGrade)for(let r=0;t.length>r;r++){if(e.jdParent==t[r].jdName){let e=this.isRepeat(t[r].children);e.is&&(this.$alert("名称不能重复","提示",{confirmButtonText:"确定"}),t[r].children[e.index].jdName="",this.tableData[0].children=JSON.parse(JSON.stringify(t)))}if(3==e.jdGrade)for(let l=0;t[r].children.length>l;l++)if(e.jdParent==t[r].children[l].jdName){let e=this.isRepeat(t[r].children[l].children);e.is&&(this.$alert("名称不能重复","提示",{confirmButtonText:"确定"}),t[r].children[l].children[e.index].jdName="",this.tableData[0].children=JSON.parse(JSON.stringify(t)))}}},addalertaddblur(e){let t=this.isRepeat(e);t.is&&(this.$alert("名称不能重复","提示",{confirmButtonText:"确定"}),e[t.index].jdName="",this.tableData[0].children=JSON.parse(JSON.stringify(e)))},isRepeat(e){let t={},r={index:null,is:!0};for(let l=0;l<e.length;l++)t[e[l].jdName]?r.index=l:t[e[l].jdName]=!0;return Object.keys(t).length<e.length?r.is=!0:r.is=!1,r},updatascope(e){let t=this.tableData[0].children;for(let r=0;t.length>r;r++)if(t[r].jdName==e.jdName&&t[r].jdParent==e.jdParent)t.splice(r,1);else if(t[r].children)for(let l=0;t[r].children.length>l;l++)if(t[r].children[l].jdName==e.jdName&&t[r].children[l].jdParent==e.jdParent)t[r].children.splice(l,1);else if(t[r].children[l].children)for(let n=0;t[r].children[l].children.length>n;n++)t[r].children[l].children[n].jdName==e.jdName&&t[r].children[l].children[n].jdParent==e.jdParent&&t[r].children[l].children.splice(n,1);else t[r].children[l].children=[];else t[r].children=[];this.tableData[0].children=JSON.parse(JSON.stringify(t))},saveDataTree(){let e={jdGrade:this.tableobj.jdGrade,jdName:this.tableobj.jdName,jdParent:this.tableobj.jdParent,rules:this.temp.rules,status:this.temp.status};this.saveDataTreeadd(e),this.dialogVisibletree=!1},saveDataTreeadd(e){let t=this.tableData[0].children;for(let r=0;t.length>r;r++)if(t[r].jdGrade==e.jdGrade&&t[r].jdName==e.jdName&&t[r].jdParent==e.jdParent&&(t[r].rules=e.rules,t[r].status=e.status),(2==e.jdGrade||3==e.jdGrade)&&t[r].children)for(let l=0;t[r].children.length>l;l++)if(t[r].children[l].jdGrade==e.jdGrade&&t[r].children[l].jdName==e.jdName&&t[r].children[l].jdParent==e.jdParent&&(t[r].children[l].rules=e.rules,t[r].children[l].status=e.status),3==e.jdGrade&&t[r].children[l].children)for(let n=0;t[r].children[l].children.length>n;n++)t[r].children[l].children[n].jdGrade==e.jdGrade&&t[r].children[l].children[n].jdName==e.jdName&&t[r].children[l].children[n].jdParent==e.jdParent&&(t[r].children[l].children[n].rules=e.rules,t[r].children[l].children[n].status=e.status);this.tableData[0].children=JSON.parse(JSON.stringify(t))},handleEdit(e){if(this.$refs.tree&&this.$refs.tree.setCheckedKeys([]),this.dialogVisibletree=!this.dialogVisibletree,this.tableobj={},this.tableobj=e,this.temp.title=e.jdName,e.rules){let t=e.rules.split(",");this.$nextTick((()=>{this.$refs.tree&&this.$refs.tree.setCheckedKeys(t)}))}},buttonReset(e){return!1},getRules(){(0,a.Im)().then((e=>{this.ruleList=e.data}))},resetTemp(){this.temp={id:0,jdName:"",jdParent:"",jdGrade:1,status:1,rules:""}},checkHandle(e){const t=this.$refs.tree.getHalfCheckedKeys().join(","),r=this.$refs.tree.getCheckedKeys().join(",");t.length&&r.length?this.temp.rules=t+","+r:t.length&&0===r.length?this.temp.rules=t:0===t.length&&r.length?this.temp.rules=r:this.temp.rules=""},handleCreate(){this.dialogStatus="create",this.dialogFormVisible=!0,this.currentIndex=-1,this.$refs.tree&&this.$refs.tree.setCheckedKeys([]),this.getinfoListdData(this.group)},getinfoListdData(e){let t=this;(0,d.fy)(e).then((e=>{if(1==e.status){let r=e.data,l=[];for(let e=0;r.length>e;e++)if(1==r[e].jdGrade&&(r[e].children=[],r[e].is=!0,l.push(r[e])),2==r[e].jdGrade||3==r[e].jdGrade)for(let t=0;l.length>t;t++)if(l[t].jdName==r[e].jdParent&&(r[e].children=[],r[e].is=!0,l[t].children.push(r[e])),3==r[e].jdGrade)for(let n=0;l[t].children.length>n;n++)l[t].children[n].jdName==r[e].jdParent&&(r[e].children=[],r[e].is=!0,l[t].children[n].children.push(r[e]));let n=l,i=t.clone(n);t.tableData=[{id:0,jdName:t.group,rules:"",jdGrade:0,jdParent:"顶级",children:i}]}})),this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},clone(e){let t=this;for(let r=0;e.length>r;r++)(1==e[r].jdGrade||2==e[r].jdGrade||3==e[r].jdGrade)&&("children"in e[r]||(e[r].children=new Array)),"children"in e[r]&&t.clone(e[r].children);return e},flatten(e){let t=this;return e?[].concat(...e.map((e=>[].concat(e,...t.flatten(e.children))))):e},saveData(){return this.dialogFormVisible=!1,!1}}}),u=o,c=r(1001),h=(0,c.Z)(u,l,n,!1,null,"fc22a590",null),f=h.exports},92923:function(e,t,r){r.d(t,{IV:function(){return u},Im:function(){return i},Y1:function(){return a},a1:function(){return s},fy:function(){return d},gp:function(){return n},hc:function(){return f},m:function(){return c},nV:function(){return o},yu:function(){return h}});var l=r(84471);function n(e){return(0,l.Z)({url:"/admin/roles/index",method:"post",data:e})}function i(){return(0,l.Z)({url:"/admin/roles/getLists",method:"post"})}function a(e){return(0,l.Z)({url:"/admin/roles/getinfo",method:"get",params:{id:e}})}function d(e){return(0,l.Z)({url:"/admin/roles/getinfoList",method:"get",params:{name:e}})}function s(e){return(0,l.Z)({url:"/admin/roles/save",method:"post",data:e})}function o(e){return(0,l.Z)({url:"/admin/roles/saveList",method:"post",data:e})}function u(e){return(0,l.Z)({url:"/admin/roles/del",method:"get",params:{id:e}})}function c(e,t,r){const n={val:e,field:t,value:r};return(0,l.Z)({url:"/admin/roles/change",method:"post",data:n})}function h(e){return(0,l.Z)({url:"/admin/roles/delall",method:"post",data:e})}function f(e){return(0,l.Z)({url:"/admin/roles/changeall",method:"post",data:e})}},94053:function(e,t,r){r.d(t,{IV:function(){return s},Im:function(){return i},Y1:function(){return a},a1:function(){return d},gp:function(){return n},hc:function(){return c},m:function(){return o},yu:function(){return u}});var l=r(84471);function n(e){return(0,l.Z)({url:"/admin/rules/index",method:"post",data:e})}function i(){return(0,l.Z)({url:"/admin/rules/getLists",method:"post"})}function a(e){return(0,l.Z)({url:"/admin/rules/getinfo",method:"get",params:{id:e}})}function d(e){return(0,l.Z)({url:"/admin/rules/save",method:"post",data:e})}function s(e){return(0,l.Z)({url:"/admin/rules/del",method:"get",params:{id:e}})}function o(e,t,r){const n={val:e,field:t,value:r};return(0,l.Z)({url:"/admin/rules/change",method:"post",data:n})}function u(e){return(0,l.Z)({url:"/admin/rules/delall",method:"post",data:e})}function c(e){return(0,l.Z)({url:"/admin/rules/changeall",method:"post",data:e})}},57801:function(e,t,r){r(57658),r(30541);var l=r(42325);function n(e,t=0,r="id",i="pid",a="children",d=null){const s=[];return e&&e.forEach((o=>{if(o[i]===t){null!==d&&(o=(0,l.hq)(o,d));const t=n(e,o[r],r,i,a,d);t.length&&(o[a]=t),s.push(o)}})),s}function i(e,t,r="id",l="pid"){let n=[];return e&&e.forEach((a=>{if(a[r]===t){n.unshift(a[l]);const t=i(e,a[l],r,l);t.length&&(n=n.concat(t))}})),n}function a(e,t,r,n){return e&&e.map((e=>{e[t]===r?(0,l.hq)(e,n):a(e.children,t,r,n)})),e}const d={listToTreeMulti:n,getParentsId:i,upadteArr:a};t["Z"]=d},84722:function(e,t,r){r.d(t,{kK:function(){return l}});r(57658),r(82801);const l=(e,t)=>{let r="";return r=Math.ceil(1e14*Math.random()).toString().substr(0,e||4),t&&(r+=Date.now()),r}}}]);