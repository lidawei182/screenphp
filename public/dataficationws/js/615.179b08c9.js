"use strict";(self["webpackChunkdatafication"]=self["webpackChunkdatafication"]||[]).push([[615,765],{73126:function(e,t,a){a.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("el-table",e._b({attrs:{data:e.formatData,"row-style":e.showRow},on:{"selection-change":e.handleSelectionChange}},"el-table",e.$attrs,!1),[t("el-table-column",{attrs:{type:"selection",width:"55px"}}),0===e.columns.length?t("el-table-column",{attrs:{width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._l(a.row._level,(function(e){return t("span",{key:e,staticClass:"ms-tree-space"})})),e.iconShow(0,a.row)?t("span",{staticClass:"tree-ctrl",on:{click:function(t){return e.toggleExpanded(a.$index)}}},[a.row._expanded?t("i",{staticClass:"el-icon-minus"}):t("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(a.$index)+" ")]}}],null,!1,601564488)}):e._l(e.columns,(function(a,l){return t("el-table-column",{key:a.value,attrs:{label:a.text,width:a.width},scopedSlots:e._u([{key:"default",fn:function(n){return[e._l(n.row._level,(function(a){return t("span",{key:a},[0===l?t("span",{staticClass:"ms-tree-space"}):e._e()])})),e.iconShow(l,n.row)?t("span",{staticClass:"tree-ctrl",on:{click:function(t){return e.toggleExpanded(n.$index)}}},[n.row._expanded?t("i",{staticClass:"el-icon-minus"}):t("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(n.row[a.value])+" ")]}}],null,!0)})})),e._t("default")],2)},n=[],s=(a(57658),a(36369));function i(e,t,a=null,l=null){let n=[];return Array.from(e).forEach((function(e){void 0===e._expanded&&s["default"].set(e,"_expanded",t);let o=1;if(void 0!==l&&null!==l&&(o=l+1),s["default"].set(e,"_level",o),a&&s["default"].set(e,"parent",a),n.push(e),e.children&&e.children.length>0){const a=i(e.children,t,e,o);n=n.concat(a)}})),n}var o={name:"TreeTable",props:{data:{type:[Array,Object],required:!0},columns:{type:Array,default:()=>[]},evalFunc:Function,evalArgs:Array,expandAll:{type:Boolean,default:!1}},computed:{formatData:function(){let e;e=Array.isArray(this.data)?this.data:[this.data];const t=this.evalFunc||i,a=this.evalArgs?Array.concat([e,this.expandAll],this.evalArgs):[e,this.expandAll];return t.apply(null,a)}},methods:{showRow:function(e){const t=!e.row.parent||e.row.parent._expanded&&e.row.parent._show;return e.row._show=t,t?"animation:treeTableShow 1s;-webkit-animation:treeTableShow 1s;":"display:none;"},toggleExpanded:function(e){const t=this.formatData[e];t._expanded=!t._expanded},iconShow(e,t){return 0===e&&t.children&&t.children.length>0},handleSelectionChange(e){this.$emit("selection-change",e)}}},r=o,c=a(1001),d=(0,c.Z)(r,l,n,!1,null,"4338b41f",null),u=d.exports},92615:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("el-row",{staticStyle:{"margin-bottom":"10px"}},[t("el-col",{attrs:{xs:24,sm:24,lg:24}},[t("el-tooltip",{attrs:{content:"刷新",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"warning",icon:"el-icon-refresh",circle:""},on:{click:e.handleFilterClear}})],1),t("el-tooltip",{attrs:{content:"添加",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"success",icon:"el-icon-plus",circle:""},on:{click:e.handleCreate}})],1),t("el-tooltip",{attrs:{content:"删除",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{loading:e.deleting,disabled:e.buttonDisabled,type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.handleDeleteAll()}}})],1),t("el-tooltip",{attrs:{content:"更多",placement:"top"}},[t("el-dropdown",{staticStyle:{"margin-left":"10px"},attrs:{trigger:"click",placement:"bottom"},on:{command:e.handleCommand}},[t("el-button",{attrs:{disabled:e.buttonDisabled,type:"Info",circle:""}},[t("i",{staticClass:"el-icon-more"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"1"}},[e._v("设为正常")]),t("el-dropdown-item",{attrs:{command:"0"}},[e._v("设为禁用")])],1)],1)],1)],1)],1),t("tree-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.getRulesList,"expand-all":e.expandAll,columns:e.columns,border:"",fit:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{label:"标识",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.name))])]}}])}),t("el-table-column",{attrs:{label:"图标",width:"80px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.icon))])]}}])}),t("el-table-column",{attrs:{label:"路径",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.path))])]}}])}),t("el-table-column",{attrs:{label:"组件",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.component))])]}}])}),t("el-table-column",{attrs:{label:"状态",width:"80px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:{"el-icon-success text-green":1==a.row.status,"el-icon-error text-red":0==a.row.status},on:{click:function(t){return e.handleModifyStatus(a.$index,a.row.id,a.row.status)}}},[e._v(e._s(e._f("statusFilter")(a.row.status)))])]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"120px","class-name":"small-padding"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tooltip",{attrs:{content:"编辑",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-edit-outline",circle:""},on:{click:function(t){return e.handleUpdate(a.$index,a.row.id)}}})],1),t("el-tooltip",{attrs:{content:"删除",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{loading:a.row.delete,type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.handleDelete(a.$index,a.row.id)}}})],1)]}}])})],1),t("rulesForm",{ref:"fromRules",attrs:{"rule-list":e.list},on:{updateRow:e.updateRow}})],1)},n=[],s=a(94053),i=a(40204),o=a(42325),r=a(57801),c=a(64765),d=a(73126),u={name:"Rules",components:{rulesForm:c["default"],treeTable:d.Z},directives:{waves:i.Z},filters:{statusFilter(e){const t={0:"禁用",1:"正常"};return t[e]}},data(){return{tableKey:0,list:null,selectedRows:null,listLoading:!0,expandAll:!0,columns:[{text:"名称",value:"title"}],listQuery:{status:"-1",title:""},buttonDisabled:!0,deleting:!1}},computed:{getRulesList(){return r.Z.listToTreeMulti(this.list,0,"id","pid","children",{delete:!1})}},watch:{},created(){this.fetchList()},methods:{fetchList(){this.listLoading=!0,(0,s.gp)(this.listQuery).then((e=>{this.list=e.data.data,this.listLoading=!1}))},handleFilterClear(){this.listQuery={status:"-1",title:""},this.fetchList()},handleSelectionChange(e){e.length>0?this.buttonDisabled=!1:this.buttonDisabled=!0,this.selectedRows=e},handleCreate(){this.$refs.fromRules.handleCreate()},handleUpdate(e,t){this.$refs.fromRules.handleUpdate(t)},handleModifyStatus(e,t,a){const l={status:1-a};this.list=r.Z.upadteArr(this.list,"id",t,l),(0,s.m)(t,"status",1-a).then((e=>{}))},updateRow(e){this.fetchList()},handleDelete(e,t){const a=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={delete:!0};a.list=r.Z.upadteArr(a.list,"id",t,e),(0,s.IV)(t).then((e=>{1===e.status?(a.$notify.success(e.msg),a.fetchList()):a.$notify.error(e.msg);const l={delete:!1};a.list=r.Z.upadteArr(a.list,"id",t,l)})).catch((e=>{const l={delete:!1};a.list=r.Z.upadteArr(a.list,"id",t,l)}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},handleDeleteAll(){const e=this;this.selectedRows.length>0?this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e.deleting=!0;const t=(0,o.XN)(e.selectedRows,"id"),a=t.join(",");(0,s.yu)({ids:a}).then((t=>{1===t.status?(e.$message.success(t.msg),e.fetchList()):e.$message.error(t.msg),e.deleting=!1})).catch((t=>{e.deleting=!1}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})})):e.$message.error("请选择要删除的数据")},handleCommand(e){const t=this;if(this.selectedRows.length>0){const a=(0,o.XN)(this.selectedRows,"id"),l=a.join(",");(0,s.hc)({val:l,field:"status",value:e}).then((e=>{1===e.status?(t.$message.success(e.msg),t.fetchList()):t.$message.error(e.msg)})).catch((e=>{}))}else t.$message.error("请选择要操作的数据")}}},p=u,m=a(1001),h=(0,m.Z)(p,l,n,!1,null,null,null),f=h.exports},64765:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"dataForm",staticStyle:{width:"100%",height:"50vh","overflow-y":"scroll"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"70px"}},[t("el-form-item",{attrs:{label:"上级",prop:"pid"}},[t("el-cascader",{attrs:{options:e.getRulesList,props:e.props_pid,placeholder:"请选择","change-on-select":""},on:{change:e.handleChange},model:{value:e.pid,callback:function(t){e.pid=t},expression:"pid"}})],1),t("el-form-item",{attrs:{label:"名称",prop:"title"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.title,callback:function(t){e.$set(e.temp,"title",t)},expression:"temp.title"}})],1),t("el-form-item",{attrs:{label:"标识",prop:"name"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.name,callback:function(t){e.$set(e.temp,"name",t)},expression:"temp.name"}})],1),t("el-form-item",{attrs:{label:"图标",prop:"icon"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.icon,callback:function(t){e.$set(e.temp,"icon",t)},expression:"temp.icon"}})],1),t("el-form-item",{attrs:{label:"路径",prop:"path"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.path,callback:function(t){e.$set(e.temp,"path",t)},expression:"temp.path"}})],1),t("el-form-item",{attrs:{label:"组件",prop:"component"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.component,callback:function(t){e.$set(e.temp,"component",t)},expression:"temp.component"}})],1),t("el-form-item",{attrs:{label:"跳转",prop:"redirect"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.redirect,callback:function(t){e.$set(e.temp,"redirect",t)},expression:"temp.redirect"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{model:{value:e.temp.status,callback:function(t){e.$set(e.temp,"status",t)},expression:"temp.status"}},[t("el-radio",{attrs:{label:1}},[e._v("正常")]),t("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1),t("el-form-item",{attrs:{label:"隐藏"}},[t("el-radio-group",{model:{value:e.temp.hidden,callback:function(t){e.$set(e.temp,"hidden",t)},expression:"temp.hidden"}},[t("el-radio",{attrs:{label:1}},[e._v("是")]),t("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),t("el-form-item",{attrs:{label:"缓存"}},[t("el-radio-group",{model:{value:e.temp.noCache,callback:function(t){e.$set(e.temp,"noCache",t)},expression:"temp.noCache"}},[t("el-radio",{attrs:{label:0}},[e._v("是")]),t("el-radio",{attrs:{label:1}},[e._v("否")])],1)],1),t("el-form-item",{attrs:{label:"展示"}},[t("el-radio-group",{model:{value:e.temp.alwaysShow,callback:function(t){e.$set(e.temp,"alwaysShow",t)},expression:"temp.alwaysShow"}},[t("el-radio",{attrs:{label:1}},[e._v("是")]),t("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.btnLoading,type:"primary"},on:{click:function(t){return e.saveData()}}},[e._v("保存")])],1)],1)},n=[],s=a(94053),i=a(57801),o={name:"RulesForm",components:{},props:{ruleList:{type:Array,default:()=>[]}},data(){return{btnLoading:!1,ruleTop:[{id:0,title:"顶级"}],pid:[],props_pid:{label:"title",value:"id"},temp:{id:0,pid:0,title:"",name:"",status:1,icon:"",path:"",component:"layout/Layout",hidden:0,noCache:1,alwaysShow:1,redirect:"noredirect"},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑",create:"添加"},rules:{title:[{required:!0,message:"名称必填",trigger:"blur"}],name:[{required:!0,message:"标识必填",trigger:"blur"}],icon:[{required:!0,message:"图标必填",trigger:"blur"}],path:[{required:!0,message:"路径必填",trigger:"blur"}],component:[{required:!0,message:"组件必填",trigger:"blur"}]}}},computed:{getRulesList(){return this.ruleTop.concat(i.Z.listToTreeMulti(this.ruleList))}},watch:{dialogFormVisible:function(){this.resetTemp()},temp:{handler(e,t){},immediate:!0,deep:!0}},created(){},destroyed(){},methods:{resetTemp(){this.temp={id:0,pid:0,title:"",name:"",status:1,icon:"",path:"",component:"layout/Layout",hidden:0,noCache:1,alwaysShow:1,redirect:"noredirect"}},handleCreate(){this.dialogStatus="create",this.dialogFormVisible=!0,this.currentIndex=-1,this.pid=[],this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},handleUpdate(e){this.dialogStatus="update",this.dialogFormVisible=!0;const t=this;(0,s.Y1)(e).then((a=>{1===a.status&&(t.temp.id=a.data.id,t.temp.pid=a.data.pid,t.temp.title=a.data.title,t.temp.name=a.data.name,t.temp.status=a.data.status,t.temp.icon=a.data.icon,t.temp.path=a.data.path,t.temp.component=a.data.component,t.temp.hidden=a.data.hidden,t.temp.noCache=a.data.noCache,t.temp.alwaysShow=a.data.alwaysShow,t.temp.redirect=a.data.redirect,t.pid=i.Z.getParentsId(this.ruleList,e))})),this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},saveData(){this.btnLoading=!0,this.$refs["dataForm"].validate((e=>{if(e){const e=this,t=this.temp;(0,s.a1)(t).then((a=>{1===a.status?(t.id||(t.id2=a.data.id),this.$emit("updateRow",t),e.dialogFormVisible=!1,e.$message.success(a.msg)):e.$message.error(a.msg),e.btnLoading=!1})).catch((e=>{this.btnLoading=!1}))}else this.btnLoading=!1}))},handleChange(e){e.length&&(this.temp.pid=e[e.length-1])}}},r=o,c=a(1001),d=(0,c.Z)(r,l,n,!1,null,null,null),u=d.exports},94053:function(e,t,a){a.d(t,{IV:function(){return r},Im:function(){return s},Y1:function(){return i},a1:function(){return o},gp:function(){return n},hc:function(){return u},m:function(){return c},yu:function(){return d}});var l=a(84471);function n(e){return(0,l.Z)({url:"/admin/rules/index",method:"post",data:e})}function s(){return(0,l.Z)({url:"/admin/rules/getLists",method:"post"})}function i(e){return(0,l.Z)({url:"/admin/rules/getinfo",method:"get",params:{id:e}})}function o(e){return(0,l.Z)({url:"/admin/rules/save",method:"post",data:e})}function r(e){return(0,l.Z)({url:"/admin/rules/del",method:"get",params:{id:e}})}function c(e,t,a){const n={val:e,field:t,value:a};return(0,l.Z)({url:"/admin/rules/change",method:"post",data:n})}function d(e){return(0,l.Z)({url:"/admin/rules/delall",method:"post",data:e})}function u(e){return(0,l.Z)({url:"/admin/rules/changeall",method:"post",data:e})}},40204:function(e,t,a){a.d(t,{Z:function(){return o}});const l="@@wavesContext";function n(e,t){function a(a){const l=Object.assign({},t.value),n=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},l),s=n.ele;if(s){s.style.position="relative",s.style.overflow="hidden";const e=s.getBoundingClientRect();let t=s.querySelector(".waves-ripple");switch(t?t.className="waves-ripple":(t=document.createElement("span"),t.className="waves-ripple",t.style.height=t.style.width=Math.max(e.width,e.height)+"px",s.appendChild(t)),n.type){case"center":t.style.top=e.height/2-t.offsetHeight/2+"px",t.style.left=e.width/2-t.offsetWidth/2+"px";break;default:t.style.top=(a.pageY-e.top-t.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",t.style.left=(a.pageX-e.left-t.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return t.style.backgroundColor=n.color,t.className="waves-ripple z-active",!1}}return e[l]?e[l].removeHandle=a:e[l]={removeHandle:a},a}var s={bind(e,t){e.addEventListener("click",n(e,t),!1)},update(e,t){e.removeEventListener("click",e[l].removeHandle,!1),e.addEventListener("click",n(e,t),!1)},unbind(e){e.removeEventListener("click",e[l].removeHandle,!1),e[l]=null,delete e[l]}};const i=function(e){e.directive("waves",s)};window.Vue&&(window.waves=s,Vue.use(i)),s.install=i;var o=s},57801:function(e,t,a){a(57658),a(30541);var l=a(42325);function n(e,t=0,a="id",s="pid",i="children",o=null){const r=[];return e&&e.forEach((c=>{if(c[s]===t){null!==o&&(c=(0,l.hq)(c,o));const t=n(e,c[a],a,s,i,o);t.length&&(c[i]=t),r.push(c)}})),r}function s(e,t,a="id",l="pid"){let n=[];return e&&e.forEach((i=>{if(i[a]===t){n.unshift(i[l]);const t=s(e,i[l],a,l);t.length&&(n=n.concat(t))}})),n}function i(e,t,a,n){return e&&e.map((e=>{e[t]===a?(0,l.hq)(e,n):i(e.children,t,a,n)})),e}const o={listToTreeMulti:n,getParentsId:s,upadteArr:i};t["Z"]=o}}]);