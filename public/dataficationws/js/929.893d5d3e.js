"use strict";(self["webpackChunkdatafication"]=self["webpackChunkdatafication"]||[]).push([[929,470],{24754:function(e,t,s){s.r(t),s.d(t,{default:function(){return g}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[e.showSearch?t("div",{staticClass:"filter-container"},[t("el-form",{staticClass:"form-inline",attrs:{inline:!0,model:e.listQuery}},[t("el-form-item",{attrs:{label:""}},[t("el-input",{attrs:{placeholder:"名称",clearable:"",size:"small"},model:{value:e.listQuery.jdName,callback:function(t){e.$set(e.listQuery,"jdName",t)},expression:"listQuery.jdName"}})],1),t("el-form-item",{attrs:{label:""}},[t("el-select",{attrs:{placeholder:"状态",clearable:"",size:"small"},model:{value:e.listQuery.status,callback:function(t){e.$set(e.listQuery,"status",t)},expression:"listQuery.status"}},[t("el-option",{attrs:{label:"正常",value:"1"}}),t("el-option",{attrs:{label:"禁用",value:"0"}})],1)],1),t("el-form-item",[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:e.handleFilter}},[e._v("搜索")])],1),t("el-form-item",[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"warning",icon:"el-icon-refresh",size:"small"},on:{click:e.handleFilterClear}},[e._v("重置")])],1)],1)],1):e._e(),t("el-row",{staticStyle:{"margin-bottom":"10px"}},[t("el-col",{attrs:{xs:24,sm:24,lg:24}},[t("el-tooltip",{attrs:{content:"刷新",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"warning",icon:"el-icon-refresh",circle:""},on:{click:e.handleFilterClear}})],1),t("el-tooltip",{attrs:{content:"添加",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"success",icon:"el-icon-plus",circle:""},on:{click:e.handleCreate}})],1),t("el-tooltip",{attrs:{content:"更多",placement:"top"}},[t("el-dropdown",{staticStyle:{"margin-left":"10px"},attrs:{trigger:"click",placement:"bottom"},on:{command:e.handleCommand}},[t("el-button",{attrs:{disabled:e.buttonDisabled,type:"Info",circle:""}},[t("i",{staticClass:"el-icon-more"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"1"}},[e._v("设为正常")]),t("el-dropdown-item",{attrs:{command:"0"}},[e._v("设为禁用")])],1)],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticClass:"headercellclassname",staticStyle:{width:"100%"},attrs:{data:e.list,border:"",fit:"",stripe:"","highlight-current-row":"","row-style":{backgroundColor:"#000e21"},"cell-style":{borderColor:"#000e21"},"header-cell-style":{background:"#011531",borderColor:"#000e21"}},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{label:"ID",align:"center",width:"65"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",[e._v(e._s(s.row.id))])]}}])}),t("el-table-column",{attrs:{label:"名称","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{staticClass:"link-type",on:{click:function(t){return e.handleUpdate(s.$index,s.row.id)}}},[e._v(e._s(s.row.jdName))])]}}])}),t("el-table-column",{attrs:{label:"上级","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.jdParent?t("span",[e._v(e._s(s.row.jdParent))]):t("span",[e._v("最高权限")])]}}])}),t("el-table-column",{attrs:{label:"级别",width:"110px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",[e._v(e._s(e._f("jdGradeFilter")(s.row.jdGrade)))])]}}])}),t("el-table-column",{attrs:{label:"状态",width:"110px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{class:{"el-icon-success text-green":1==s.row.status,"el-icon-error text-red":0==s.row.status},on:{click:function(t){return e.handleModifyStatus(s.$index,s.row.id,s.row.status)}}},[e._v(e._s(e._f("statusFilter")(s.row.status)))])]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"120px","class-name":"small-padding"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tooltip",{attrs:{content:"编辑",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-edit-outline",circle:""},on:{click:function(t){return e.handleUpdate(s.$index,s.row.id)}}})],1),t("el-tooltip",{attrs:{content:"删除",placement:"top"}},[t("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{loading:s.row.delete,type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.handleDelete(s.$index,s.row.id)}}})],1)]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{"current-page":e.listQuery.page,"page-sizes":[10,20,30,50],"page-size":e.listQuery.psize,total:e.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("rolesForm",{ref:"fromRoles",on:{updateRow:e.updateRow}}),t("rolesFormList",{ref:"fromRolesList",on:{updateRowList:e.updateRowList}})],1)},l=[],i=(s(57658),s(63822)),n=s(92923),r=s(40204),o=s(42325),d=s(94565),c=s(29681),u=s(23518),h={name:"Roles",components:{rolesForm:d["default"],rolesFormList:c["default"]},directives:{waves:r.Z},computed:{...(0,i.Se)(["group"])},filters:{statusFilter(e){const t={0:"禁用",1:"正常"};return t[e]},jdGradeFilter(e){const t={0:"顶级",1:"高级",2:"中级",3:"低级"};return t[e]}},data(){return{tableKey:0,list:null,total:null,selectedRows:null,listLoading:!0,showSearch:!1,listQuery:{page:1,psize:10,status:"1",jdName:"",jdParent:this.group},buttonDisabled:!0,deleting:!1,pickerOptions:o.Pk,currentIndex:-1}},watch:{},created(){},mounted(){this.listQuery.jdParent=this.group,this.fetchList()},methods:{fetchList(){this.listLoading=!0,this.listQuery.jdParent=this.group,(0,n.gp)(this.listQuery).then((e=>{u.log(e.data.data),this.list=e.data.data,this.total=e.data.total,this.listLoading=!1}))},handleFilter(){this.listQuery.page=1,this.fetchList()},handleFilterClear(){this.listQuery={page:1,psize:10,status:"1",jdName:""},this.fetchList()},handleSizeChange(e){this.listQuery.psize=e,this.fetchList()},handleCurrentChange(e){this.listQuery.page=e,this.fetchList()},handleModifyStatus(e,t,s){this.list[e]["status"]=1-s,(0,n.m)(t,"status",1-s).then((e=>{}))},handleSelectionChange(e){e.length>0?this.buttonDisabled=!1:this.buttonDisabled=!0,this.selectedRows=e},handleCreate(){this.$refs.fromRolesList.handleCreate()},handleUpdate(e,t){this.currentIndex=e,this.$refs.fromRoles.handleUpdate(t)},updateRow(e){this.currentIndex>=0&&e.id>0?this.list.splice(this.currentIndex,1,e):(this.list.length>=10&&this.list.pop(),this.list.push(e),this.total=this.total+1),this.currentIndex=-1},updateRowList(e){u.log(e),this.handleFilterClear()},handleDelete(e,t){const s=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{s.$set(s.list[e],"delete",!0),(0,n.IV)(t).then((e=>{1===e.status?(s.handleFilterClear(),s.$notify.success(e.msg)):s.$notify.error(e.msg)})).catch((()=>{}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},handleDeleteAll(){const e=this;this.selectedRows.length>0?this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e.deleting=!0;const t=(0,o.XN)(e.selectedRows,"id"),s=t.join(",");(0,n.yu)({ids:s}).then((s=>{if(1===s.status){const a=[];e.list.forEach((function(e,s,l){t.indexOf(e.id)>-1&&a.push(s)}));for(let t=a.length-1;t>=0;t--)e.list.splice(a[t],1);e.total=e.total-a.length,e.$message.success(s.msg)}else e.$message.error(s.msg);e.deleting=!1})).catch((t=>{e.deleting=!1}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})})):e.$message.error("请选择要删除的数据")},handleCommand(e){const t=this;if(this.selectedRows.length>0){const s=(0,o.XN)(this.selectedRows,"id"),a=s.join(",");(0,n.hc)({val:a,field:"status",value:e}).then((a=>{1===a.status?(t.list.forEach((function(a,l,i){s.indexOf(a.id)>-1&&(t.list[l]["status"]=e)})),t.$message.success(a.msg)):t.$message.error(a.msg)})).catch((e=>{}))}else t.$message.error("请选择要操作的数据")}}},m=h,p=s(1001),f=(0,p.Z)(m,a,l,!1,null,"348c0237",null),g=f.exports},94565:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"dataForm",staticStyle:{width:"100%",height:"50vh","overflow-y":"scroll"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"70px"}},[t("el-form-item",{attrs:{label:"名称",prop:"jdName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.jdName,callback:function(t){e.$set(e.temp,"jdName",t)},expression:"temp.jdName"}})],1),t("el-form-item",{attrs:{label:"上级",prop:"jdParent"}},[t("el-input",{attrs:{disabled:!0},model:{value:e.temp.jdParent,callback:function(t){e.$set(e.temp,"jdParent",t)},expression:"temp.jdParent"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{model:{value:e.temp.status,callback:function(t){e.$set(e.temp,"status",t)},expression:"temp.status"}},[t("el-radio",{attrs:{label:1}},[e._v("正常")]),t("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1),t("el-form-item",{attrs:{label:"权限"}},[t("el-tree",{ref:"tree",attrs:{data:e.getRulesList,"default-checked-keys":e.defaultChecked,props:e.defaultProps,"default-expand-all":"","show-checkbox":"","check-strictly":"","node-key":"id"},on:{check:e.checkHandle}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.btnLoading,type:"primary"},on:{click:function(t){return e.saveData()}}},[e._v("保存")])],1)],1)},l=[],i=s(94053),n=s(92923),r=s(57801),o={name:"RolesForm",data(){return{btnLoading:!1,ruleList:[],temp:{id:0,jdName:"",jdParent:"",jdGrade:1,status:1,rules:""},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑",create:"添加"},rules:{jdName:[{required:!0,message:"名称必填",trigger:"blur"}]},defaultChecked:[],defaultProps:{children:"children",label:"title"}}},computed:{getRulesList(){return r.Z.listToTreeMulti(this.ruleList)}},watch:{dialogFormVisible:function(){this.resetTemp()}},created(){this.getRules()},destroyed(){},methods:{getRules(){(0,i.Im)().then((e=>{this.ruleList=e.data}))},resetTemp(){this.temp={id:0,jdName:"",jdParent:"",jdGrade:1,status:1,rules:""}},checkHandle(e){const t=this.$refs.tree.getHalfCheckedKeys().join(","),s=this.$refs.tree.getCheckedKeys().join(",");t.length&&s.length?this.temp.rules=t+","+s:t.length&&0===s.length?this.temp.rules=t:0===t.length&&s.length?this.temp.rules=s:this.temp.rules=""},handleUpdate(e){this.dialogStatus="update",this.dialogFormVisible=!0;const t=this;(0,n.Y1)(e).then((e=>{1===e.status&&(t.temp.id=e.data.id,t.temp.jdName=e.data.jdName,t.temp.jdParent=e.data.jdParent,t.temp.jdGrade=e.data.jdGrade,t.temp.status=e.data.status,t.temp.rules=e.data.rules,this.$refs.tree.setCheckedKeys(t.temp.rules.split(",")))})),this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},saveData(){this.btnLoading=!0,this.$refs["dataForm"].validate((e=>{if(e){const e=this,t=this.temp;(0,n.a1)(t).then((s=>{1===s.status?(t.id||(t.id=s.data.id),this.$emit("updateRow",t),e.dialogFormVisible=!1,e.$message.success(s.msg)):e.$message.error(s.msg),e.btnLoading=!1})).catch((e=>{this.btnLoading=!1}))}else this.btnLoading=!1}))}}},d=o,c=s(1001),u=(0,c.Z)(d,a,l,!1,null,null,null),h=u.exports},40204:function(e,t,s){s.d(t,{Z:function(){return r}});const a="@@wavesContext";function l(e,t){function s(s){const a=Object.assign({},t.value),l=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},a),i=l.ele;if(i){i.style.position="relative",i.style.overflow="hidden";const e=i.getBoundingClientRect();let t=i.querySelector(".waves-ripple");switch(t?t.className="waves-ripple":(t=document.createElement("span"),t.className="waves-ripple",t.style.height=t.style.width=Math.max(e.width,e.height)+"px",i.appendChild(t)),l.type){case"center":t.style.top=e.height/2-t.offsetHeight/2+"px",t.style.left=e.width/2-t.offsetWidth/2+"px";break;default:t.style.top=(s.pageY-e.top-t.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",t.style.left=(s.pageX-e.left-t.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return t.style.backgroundColor=l.color,t.className="waves-ripple z-active",!1}}return e[a]?e[a].removeHandle=s:e[a]={removeHandle:s},s}var i={bind(e,t){e.addEventListener("click",l(e,t),!1)},update(e,t){e.removeEventListener("click",e[a].removeHandle,!1),e.addEventListener("click",l(e,t),!1)},unbind(e){e.removeEventListener("click",e[a].removeHandle,!1),e[a]=null,delete e[a]}};const n=function(e){e.directive("waves",i)};window.Vue&&(window.waves=i,Vue.use(n)),i.install=n;var r=i}}]);