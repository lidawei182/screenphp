"use strict";(self["webpackChunkdatafication"]=self["webpackChunkdatafication"]||[]).push([[565],{94565:function(t,e,n){n.r(e),n.d(e,{default:function(){return m}});var r=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[e("el-form",{ref:"dataForm",staticStyle:{width:"100%",height:"50vh","overflow-y":"scroll"},attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"70px"}},[e("el-form-item",{attrs:{label:"名称",prop:"jdName"}},[e("el-input",{attrs:{clearable:""},model:{value:t.temp.jdName,callback:function(e){t.$set(t.temp,"jdName",e)},expression:"temp.jdName"}})],1),e("el-form-item",{attrs:{label:"上级",prop:"jdParent"}},[e("el-input",{attrs:{disabled:!0},model:{value:t.temp.jdParent,callback:function(e){t.$set(t.temp,"jdParent",e)},expression:"temp.jdParent"}})],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-radio-group",{model:{value:t.temp.status,callback:function(e){t.$set(t.temp,"status",e)},expression:"temp.status"}},[e("el-radio",{attrs:{label:1}},[t._v("正常")]),e("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1),e("el-form-item",{attrs:{label:"权限"}},[e("el-tree",{ref:"tree",attrs:{data:t.getRulesList,"default-checked-keys":t.defaultChecked,props:t.defaultProps,"default-expand-all":"","show-checkbox":"","check-strictly":"","node-key":"id"},on:{check:t.checkHandle}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{loading:t.btnLoading,type:"primary"},on:{click:function(e){return t.saveData()}}},[t._v("保存")])],1)],1)},a=[],i=n(94053),s=n(92923),l=n(57801),o={name:"RolesForm",data(){return{btnLoading:!1,ruleList:[],temp:{id:0,jdName:"",jdParent:"",jdGrade:1,status:1,rules:""},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑",create:"添加"},rules:{jdName:[{required:!0,message:"名称必填",trigger:"blur"}]},defaultChecked:[],defaultProps:{children:"children",label:"title"}}},computed:{getRulesList(){return l.Z.listToTreeMulti(this.ruleList)}},watch:{dialogFormVisible:function(){this.resetTemp()}},created(){this.getRules()},destroyed(){},methods:{getRules(){(0,i.Im)().then((t=>{this.ruleList=t.data}))},resetTemp(){this.temp={id:0,jdName:"",jdParent:"",jdGrade:1,status:1,rules:""}},checkHandle(t){const e=this.$refs.tree.getHalfCheckedKeys().join(","),n=this.$refs.tree.getCheckedKeys().join(",");e.length&&n.length?this.temp.rules=e+","+n:e.length&&0===n.length?this.temp.rules=e:0===e.length&&n.length?this.temp.rules=n:this.temp.rules=""},handleUpdate(t){this.dialogStatus="update",this.dialogFormVisible=!0;const e=this;(0,s.Y1)(t).then((t=>{1===t.status&&(e.temp.id=t.data.id,e.temp.jdName=t.data.jdName,e.temp.jdParent=t.data.jdParent,e.temp.jdGrade=t.data.jdGrade,e.temp.status=t.data.status,e.temp.rules=t.data.rules,this.$refs.tree.setCheckedKeys(e.temp.rules.split(",")))})),this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},saveData(){this.btnLoading=!0,this.$refs["dataForm"].validate((t=>{if(t){const t=this,e=this.temp;(0,s.a1)(e).then((n=>{1===n.status?(e.id||(e.id=n.data.id),this.$emit("updateRow",e),t.dialogFormVisible=!1,t.$message.success(n.msg)):t.$message.error(n.msg),t.btnLoading=!1})).catch((t=>{this.btnLoading=!1}))}else this.btnLoading=!1}))}}},u=o,d=n(1001),c=(0,d.Z)(u,r,a,!1,null,null,null),m=c.exports},92923:function(t,e,n){n.d(e,{IV:function(){return d},Im:function(){return i},Y1:function(){return s},a1:function(){return o},fy:function(){return l},gp:function(){return a},hc:function(){return f},m:function(){return c},nV:function(){return u},yu:function(){return m}});var r=n(84471);function a(t){return(0,r.Z)({url:"/admin/roles/index",method:"post",data:t})}function i(){return(0,r.Z)({url:"/admin/roles/getLists",method:"post"})}function s(t){return(0,r.Z)({url:"/admin/roles/getinfo",method:"get",params:{id:t}})}function l(t){return(0,r.Z)({url:"/admin/roles/getinfoList",method:"get",params:{name:t}})}function o(t){return(0,r.Z)({url:"/admin/roles/save",method:"post",data:t})}function u(t){return(0,r.Z)({url:"/admin/roles/saveList",method:"post",data:t})}function d(t){return(0,r.Z)({url:"/admin/roles/del",method:"get",params:{id:t}})}function c(t,e,n){const a={val:t,field:e,value:n};return(0,r.Z)({url:"/admin/roles/change",method:"post",data:a})}function m(t){return(0,r.Z)({url:"/admin/roles/delall",method:"post",data:t})}function f(t){return(0,r.Z)({url:"/admin/roles/changeall",method:"post",data:t})}},94053:function(t,e,n){n.d(e,{IV:function(){return o},Im:function(){return i},Y1:function(){return s},a1:function(){return l},gp:function(){return a},hc:function(){return c},m:function(){return u},yu:function(){return d}});var r=n(84471);function a(t){return(0,r.Z)({url:"/admin/rules/index",method:"post",data:t})}function i(){return(0,r.Z)({url:"/admin/rules/getLists",method:"post"})}function s(t){return(0,r.Z)({url:"/admin/rules/getinfo",method:"get",params:{id:t}})}function l(t){return(0,r.Z)({url:"/admin/rules/save",method:"post",data:t})}function o(t){return(0,r.Z)({url:"/admin/rules/del",method:"get",params:{id:t}})}function u(t,e,n){const a={val:t,field:e,value:n};return(0,r.Z)({url:"/admin/rules/change",method:"post",data:a})}function d(t){return(0,r.Z)({url:"/admin/rules/delall",method:"post",data:t})}function c(t){return(0,r.Z)({url:"/admin/rules/changeall",method:"post",data:t})}},57801:function(t,e,n){n(57658),n(30541);var r=n(42325);function a(t,e=0,n="id",i="pid",s="children",l=null){const o=[];return t&&t.forEach((u=>{if(u[i]===e){null!==l&&(u=(0,r.hq)(u,l));const e=a(t,u[n],n,i,s,l);e.length&&(u[s]=e),o.push(u)}})),o}function i(t,e,n="id",r="pid"){let a=[];return t&&t.forEach((s=>{if(s[n]===e){a.unshift(s[r]);const e=i(t,s[r],n,r);e.length&&(a=a.concat(e))}})),a}function s(t,e,n,a){return t&&t.map((t=>{t[e]===n?(0,r.hq)(t,a):s(t.children,e,n,a)})),t}const l={listToTreeMulti:a,getParentsId:i,upadteArr:s};e["Z"]=l}}]);