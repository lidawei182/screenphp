"use strict";(self["webpackChunkdatafication"]=self["webpackChunkdatafication"]||[]).push([[494],{91494:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"dataForm",staticStyle:{width:"100%",height:"50vh","overflow-y":"scroll"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"70px"}},[t("el-form-item",{attrs:{label:"账号",prop:"userName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.userName,callback:function(t){e.$set(e.temp,"userName",t)},expression:"temp.userName"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.password,callback:function(t){e.$set(e.temp,"password",t)},expression:"temp.password"}})],1),t("el-form-item",{attrs:{label:"头像",prop:"img"}},[t("Upload",{attrs:{config:e.config,UnitNo:e.code},on:{input:function(t){return e.bindingFormImg(t)}},model:{value:e.temp.img,callback:function(t){e.$set(e.temp,"img",t)},expression:"temp.img"}})],1),t("el-form-item",{attrs:{label:"标题",prop:"realName"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.realName,callback:function(t){e.$set(e.temp,"realName",t)},expression:"temp.realName"}})],1),t("el-form-item",{attrs:{label:"手机",prop:"phone"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.phone,callback:function(t){e.$set(e.temp,"phone",t)},expression:"temp.phone"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{clearable:""},model:{value:e.temp.email,callback:function(t){e.$set(e.temp,"email",t)},expression:"temp.email"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-radio-group",{model:{value:e.temp.isEnabled,callback:function(t){e.$set(e.temp,"isEnabled",t)},expression:"temp.isEnabled"}},[t("el-radio",{attrs:{label:1}},[e._v("正常")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.btnLoading,type:"primary"},on:{click:function(t){return e.saveData()}}},[e._v("保存")])],1)],1)},r=[],o=a(63613),l=a(92923),n=a(29958),s=a(12223),m=a(42325),d=a(89176),u=a(61073),p=a(63822),c=a(23518),g={name:"AdminForm",components:{Upload:o.Z},computed:{...(0,p.Se)(["code"])},data(){var e=(e,t,a)=>{if(!(0,d.a$)(t))return a(new Error);a()},t=(e,t,a)=>{if(!(0,d.oH)(t))return a(new Error);a()};return{btnLoading:!1,roles:{},contid:"",contis:!1,temp:{id:0,userName:"",password:"",realName:"",isEnabled:1,phone:"",email:"",regTime:(0,m.Ei)(),img:[]},config:{fileName:"img",limit:1,multiple:!0,accept:"image/*",action:u.Z.uploadUrl.img},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑",create:"添加"},rules:{userName:[{required:!0,message:"账号必填",trigger:"blur"}],phone:[{validator:e,message:"手机号格式错误",trigger:"blur"}],email:[{validator:t,message:"邮箱格式错误",trigger:"blur"}]}}},watch:{dialogFormVisible:function(){c.log(this.contis);let e=this;if(this.contis&&this.temp.img.length>0){let t={img:this.temp.img[0],UnitNo:this.code};(0,s.WB)(t).then((t=>{t.data.unlink&&e.$router.go(0)}))}this.resetTemp()},temp:{handler(){},immediate:!0,deep:!0}},created(){this.getRoles()},destroyed(){},methods:{bindingFormImg(e){let t=this;(0,n.Y1)(this.contid).then((a=>{1===a.status&&(a.data.img==e?t.contis=!1:t.contis=!0)}))},getRoles(){(0,l.Im)().then((e=>{this.roles=e.data}))},resetTemp(){this.temp={id:0,userName:"",password:"",realName:"",isEnabled:1,phone:"",email:"",regTime:(0,m.Ei)(),img:[]}},handleCreate(){this.dialogStatus="create",this.dialogFormVisible=!0,this.currentIndex=-1,this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},handleUpdate(e){this.contid=e,this.dialogStatus="update",this.dialogFormVisible=!0;const t=this;(0,n.Y1)(e).then((e=>{1===e.status&&(t.temp.id=e.data.id,t.temp.userName=e.data.userName,t.temp.realName=e.data.realName,t.temp.isEnabled=e.data.isEnabled,t.temp.phone=e.data.phone,t.temp.email=e.data.email,t.temp.password="",t.temp.img=(0,m.qT)(e.data.img))})),this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},saveData(){this.btnLoading=!0,this.$refs["dataForm"].validate((e=>{if(e){let e=this,t={id:e.temp.id,userName:e.temp.userName,password:e.temp.password,realName:e.temp.realName,isEnabled:e.temp.isEnabled,phone:e.temp.phone,email:e.temp.email,regTime:e.temp.regTime,img:""};e.temp.img.length>0?t.img=e.temp.img[0]:t.img="",(0,n.a1)(t).then((a=>{1===a.status?(t.id||(t.id=a.data.id),e.contis=!1,this.$emit("updateRow",t),e.dialogFormVisible=!1,e.$message.success(a.msg),e.$router.go(0)):e.$message.error(a.msg),e.btnLoading=!1})).catch((e=>{this.btnLoading=!1}))}else this.btnLoading=!1}))}}},h=g,f=a(1001),b=(0,f.Z)(h,i,r,!1,null,null,null),v=b.exports},92923:function(e,t,a){a.d(t,{IV:function(){return d},Im:function(){return o},Y1:function(){return l},a1:function(){return s},fy:function(){return n},gp:function(){return r},hc:function(){return c},m:function(){return u},nV:function(){return m},yu:function(){return p}});var i=a(84471);function r(e){return(0,i.Z)({url:"/admin/roles/index",method:"post",data:e})}function o(){return(0,i.Z)({url:"/admin/roles/getLists",method:"post"})}function l(e){return(0,i.Z)({url:"/admin/roles/getinfo",method:"get",params:{id:e}})}function n(e){return(0,i.Z)({url:"/admin/roles/getinfoList",method:"get",params:{name:e}})}function s(e){return(0,i.Z)({url:"/admin/roles/save",method:"post",data:e})}function m(e){return(0,i.Z)({url:"/admin/roles/saveList",method:"post",data:e})}function d(e){return(0,i.Z)({url:"/admin/roles/del",method:"get",params:{id:e}})}function u(e,t,a){const r={val:e,field:t,value:a};return(0,i.Z)({url:"/admin/roles/change",method:"post",data:r})}function p(e){return(0,i.Z)({url:"/admin/roles/delall",method:"post",data:e})}function c(e){return(0,i.Z)({url:"/admin/roles/changeall",method:"post",data:e})}}}]);