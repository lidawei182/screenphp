"use strict";(self["webpackChunkdatafication"]=self["webpackChunkdatafication"]||[]).push([[304,187],{3304:function(t,e,s){s.r(e),s.d(e,{default:function(){return m}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[t.showSearch?e("div",{staticClass:"filter-container"},[e("el-form",{staticClass:"form-inline",attrs:{inline:!0,model:t.listQuery}},[e("el-form-item",{attrs:{label:""}},[e("el-input",{attrs:{placeholder:"名称",clearable:"",size:"small"},model:{value:t.listQuery.title,callback:function(e){t.$set(t.listQuery,"title",e)},expression:"listQuery.title"}})],1),e("el-form-item",{attrs:{label:""}},[e("el-select",{attrs:{placeholder:"状态",clearable:"",size:"small"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[e("el-option",{attrs:{label:"全部",value:"-1"}}),e("el-option",{attrs:{label:"正常",value:"1"}}),e("el-option",{attrs:{label:"禁用",value:"0"}})],1)],1),e("el-form-item",[e("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:t.handleFilter}},[t._v("搜索")])],1),e("el-form-item",[e("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"warning",icon:"el-icon-refresh",size:"small"},on:{click:t.handleFilterClear}},[t._v("重置")])],1)],1)],1):t._e(),e("el-row",{staticStyle:{"margin-bottom":"10px"}},[e("el-col",{attrs:{xs:24,sm:24,lg:24}},[e("el-tooltip",{attrs:{content:"刷新",placement:"top"}},[e("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"warning",icon:"el-icon-refresh",circle:""},on:{click:t.handleFilterClear}})],1),e("el-tooltip",{attrs:{content:"添加",placement:"top"}},[e("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"success",icon:"el-icon-plus",circle:""},on:{click:t.handleCreate}})],1),e("el-tooltip",{attrs:{content:"搜索",placement:"top"}},[e("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-search",circle:""},on:{click:function(e){t.showSearch=!t.showSearch}}})],1),e("el-tooltip",{attrs:{content:"删除",placement:"top"}},[e("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{loading:t.deleting,disabled:t.buttonDisabled,type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.handleDeleteAll()}}})],1),e("el-tooltip",{attrs:{content:"更多",placement:"top"}},[e("el-dropdown",{staticStyle:{"margin-left":"10px"},attrs:{trigger:"click",placement:"bottom"},on:{command:t.handleCommand}},[e("el-button",{attrs:{disabled:t.buttonDisabled,type:"Info",circle:""}},[e("i",{staticClass:"el-icon-more"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"1"}},[t._v("设为正常")]),e("el-dropdown-item",{attrs:{command:"0"}},[t._v("设为禁用")])],1)],1)],1)],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.list,border:"",fit:"","highlight-current-row":""},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{label:"ID",align:"center",width:"65"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.id))])]}}])}),e("el-table-column",{attrs:{label:"名称","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{staticClass:"link-type",on:{click:function(e){return t.handleUpdate(s.$index,s.row.id)}}},[t._v(t._s(s.row.title))])]}}])}),e("el-table-column",{attrs:{label:"状态",width:"110px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{class:{"el-icon-success text-green":1==s.row.status,"el-icon-error text-red":0==s.row.status},on:{click:function(e){return t.handleModifyStatus(s.$index,s.row.id,s.row.status)}}},[t._v(t._s(t._f("statusFilter")(s.row.status)))])]}}])}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"120px","class-name":"small-padding"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-tooltip",{attrs:{content:"编辑",placement:"top"}},[e("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",icon:"el-icon-edit-outline",circle:""},on:{click:function(e){return t.handleUpdate(s.$index,s.row.id)}}})],1),e("el-tooltip",{attrs:{content:"删除",placement:"top"}},[e("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{loading:s.row.delete,type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.handleDelete(s.$index,s.row.id)}}})],1)]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.psize,total:t.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("rolesForm",{ref:"fromRoles",on:{updateRow:t.updateRow}})],1)},l=[],i=(s(57658),s(92923)),a=s(40204),r=s(42325),o=s(10187),c={name:"Roles",components:{rolesForm:o["default"]},directives:{waves:a.Z},filters:{statusFilter(t){const e={0:"禁用",1:"正常"};return e[t]}},data(){return{tableKey:0,list:null,total:null,selectedRows:null,listLoading:!0,showSearch:!1,listQuery:{page:1,psize:10,status:"-1",title:""},buttonDisabled:!0,deleting:!1,pickerOptions:r.Pk,currentIndex:-1}},watch:{},created(){this.fetchList()},methods:{fetchList(){this.listLoading=!0,(0,i.gp)(this.listQuery).then((t=>{this.list=t.data.data,this.total=t.data.total,this.listLoading=!1}))},handleFilter(){this.listQuery.page=1,this.fetchList()},handleFilterClear(){this.listQuery={page:1,psize:10,status:"-1",title:""},this.fetchList()},handleSizeChange(t){this.listQuery.psize=t,this.fetchList()},handleCurrentChange(t){this.listQuery.page=t,this.fetchList()},handleModifyStatus(t,e,s){this.list[t]["status"]=1-s,(0,i.m)(e,"status",1-s).then((t=>{}))},handleSelectionChange(t){t.length>0?this.buttonDisabled=!1:this.buttonDisabled=!0,this.selectedRows=t},handleCreate(){this.$refs.fromRoles.handleCreate()},handleUpdate(t,e){this.currentIndex=t,this.$refs.fromRoles.handleUpdate(e)},updateRow(t){this.currentIndex>=0&&t.id>0?this.list.splice(this.currentIndex,1,t):(this.list.length>=10&&this.list.pop(),this.list.push(t),this.total=this.total+1),this.currentIndex=-1},handleDelete(t,e){const s=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{s.$set(s.list[t],"delete",!0),(0,i.IV)(e).then((e=>{1===e.status?(s.list.splice(t,1),s.total=s.total-1,s.$notify.success(e.msg)):s.$notify.error(e.msg),s.$set(s.list[t],"delete",!1)})).catch((e=>{s.$set(s.list[t],"delete",!1)}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},handleDeleteAll(){const t=this;this.selectedRows.length>0?this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{t.deleting=!0;const e=(0,r.XN)(t.selectedRows,"id"),s=e.join(",");(0,i.yu)({ids:s}).then((s=>{if(1===s.status){const n=[];t.list.forEach((function(t,s,l){e.indexOf(t.id)>-1&&n.push(s)}));for(let e=n.length-1;e>=0;e--)t.list.splice(n[e],1);t.total=t.total-n.length,t.$message.success(s.msg)}else t.$message.error(s.msg);t.deleting=!1})).catch((e=>{t.deleting=!1}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})})):t.$message.error("请选择要删除的数据")},handleCommand(t){const e=this;if(this.selectedRows.length>0){const s=(0,r.XN)(this.selectedRows,"id"),n=s.join(",");(0,i.hc)({val:n,field:"status",value:t}).then((n=>{1===n.status?(e.list.forEach((function(n,l,i){s.indexOf(n.id)>-1&&(e.list[l]["status"]=t)})),e.$message.success(n.msg)):e.$message.error(n.msg)})).catch((t=>{}))}else e.$message.error("请选择要操作的数据")}}},u=c,d=s(1001),h=(0,d.Z)(u,n,l,!1,null,null,null),m=h.exports},10187:function(t,e,s){s.r(e),s.d(e,{default:function(){return h}});var n=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[e("el-form",{ref:"dataForm",staticStyle:{width:"100%",height:"50vh","overflow-y":"scroll"},attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"70px"}},[e("el-form-item",{attrs:{label:"名称",prop:"title"}},[e("el-input",{attrs:{clearable:""},model:{value:t.temp.title,callback:function(e){t.$set(t.temp,"title",e)},expression:"temp.title"}})],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-radio-group",{model:{value:t.temp.status,callback:function(e){t.$set(t.temp,"status",e)},expression:"temp.status"}},[e("el-radio",{attrs:{label:1}},[t._v("正常")]),e("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1),e("el-form-item",{attrs:{label:"权限"}},[e("el-tree",{ref:"tree",attrs:{data:t.getRulesList,"default-checked-keys":t.defaultChecked,props:t.defaultProps,"default-expand-all":"","show-checkbox":"","check-strictly":"","node-key":"id"},on:{check:t.checkHandle}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{loading:t.btnLoading,type:"primary"},on:{click:function(e){return t.saveData()}}},[t._v("保存")])],1)],1)},l=[],i=s(94053),a=s(92923),r=s(57801),o={name:"RolesForm",data(){return{btnLoading:!1,ruleList:[],temp:{id:0,title:"",status:1,rules:""},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑",create:"添加"},rules:{title:[{required:!0,message:"名称必填",trigger:"blur"}]},defaultChecked:[],defaultProps:{children:"children",label:"title"}}},computed:{getRulesList(){return r.Z.listToTreeMulti(this.ruleList)}},watch:{dialogFormVisible:function(){this.resetTemp()}},created(){this.getRules()},destroyed(){},methods:{getRules(){(0,i.Im)().then((t=>{this.ruleList=t.data}))},resetTemp(){this.temp={id:0,title:"",status:1,rules:""}},checkHandle(t){const e=this.$refs.tree.getHalfCheckedKeys().join(","),s=this.$refs.tree.getCheckedKeys().join(",");e.length&&s.length?this.temp.rules=e+","+s:e.length&&0===s.length?this.temp.rules=e:0===e.length&&s.length?this.temp.rules=s:this.temp.rules=""},handleCreate(){this.dialogStatus="create",this.dialogFormVisible=!0,this.currentIndex=-1,this.$refs.tree.setCheckedKeys([]),this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},handleUpdate(t){this.dialogStatus="update",this.dialogFormVisible=!0;const e=this;(0,a.Y1)(t).then((t=>{1===t.status&&(e.temp.id=t.data.id,e.temp.title=t.data.title,e.temp.status=t.data.status,e.temp.rules=t.data.rules,this.$refs.tree.setCheckedKeys(e.temp.rules.split(",")))})),this.$nextTick((()=>{this.$refs["dataForm"].clearValidate()}))},saveData(){this.btnLoading=!0,this.$refs["dataForm"].validate((t=>{if(t){const t=this,e=this.temp;(0,a.a1)(e).then((s=>{1===s.status?(e.id||(e.id=s.data.id),this.$emit("updateRow",e),t.dialogFormVisible=!1,t.$message.success(s.msg)):t.$message.error(s.msg),t.btnLoading=!1})).catch((t=>{this.btnLoading=!1}))}else this.btnLoading=!1}))}}},c=o,u=s(1001),d=(0,u.Z)(c,n,l,!1,null,null,null),h=d.exports},92923:function(t,e,s){s.d(e,{IV:function(){return u},Im:function(){return i},Y1:function(){return a},a1:function(){return o},fy:function(){return r},gp:function(){return l},hc:function(){return m},m:function(){return d},nV:function(){return c},yu:function(){return h}});var n=s(84471);function l(t){return(0,n.Z)({url:"/admin/roles/index",method:"post",data:t})}function i(){return(0,n.Z)({url:"/admin/roles/getLists",method:"post"})}function a(t){return(0,n.Z)({url:"/admin/roles/getinfo",method:"get",params:{id:t}})}function r(t){return(0,n.Z)({url:"/admin/roles/getinfoList",method:"get",params:{name:t}})}function o(t){return(0,n.Z)({url:"/admin/roles/save",method:"post",data:t})}function c(t){return(0,n.Z)({url:"/admin/roles/saveList",method:"post",data:t})}function u(t){return(0,n.Z)({url:"/admin/roles/del",method:"get",params:{id:t}})}function d(t,e,s){const l={val:t,field:e,value:s};return(0,n.Z)({url:"/admin/roles/change",method:"post",data:l})}function h(t){return(0,n.Z)({url:"/admin/roles/delall",method:"post",data:t})}function m(t){return(0,n.Z)({url:"/admin/roles/changeall",method:"post",data:t})}},94053:function(t,e,s){s.d(e,{IV:function(){return o},Im:function(){return i},Y1:function(){return a},a1:function(){return r},gp:function(){return l},hc:function(){return d},m:function(){return c},yu:function(){return u}});var n=s(84471);function l(t){return(0,n.Z)({url:"/admin/rules/index",method:"post",data:t})}function i(){return(0,n.Z)({url:"/admin/rules/getLists",method:"post"})}function a(t){return(0,n.Z)({url:"/admin/rules/getinfo",method:"get",params:{id:t}})}function r(t){return(0,n.Z)({url:"/admin/rules/save",method:"post",data:t})}function o(t){return(0,n.Z)({url:"/admin/rules/del",method:"get",params:{id:t}})}function c(t,e,s){const l={val:t,field:e,value:s};return(0,n.Z)({url:"/admin/rules/change",method:"post",data:l})}function u(t){return(0,n.Z)({url:"/admin/rules/delall",method:"post",data:t})}function d(t){return(0,n.Z)({url:"/admin/rules/changeall",method:"post",data:t})}},40204:function(t,e,s){s.d(e,{Z:function(){return r}});const n="@@wavesContext";function l(t,e){function s(s){const n=Object.assign({},e.value),l=Object.assign({ele:t,type:"hit",color:"rgba(0, 0, 0, 0.15)"},n),i=l.ele;if(i){i.style.position="relative",i.style.overflow="hidden";const t=i.getBoundingClientRect();let e=i.querySelector(".waves-ripple");switch(e?e.className="waves-ripple":(e=document.createElement("span"),e.className="waves-ripple",e.style.height=e.style.width=Math.max(t.width,t.height)+"px",i.appendChild(e)),l.type){case"center":e.style.top=t.height/2-e.offsetHeight/2+"px",e.style.left=t.width/2-e.offsetWidth/2+"px";break;default:e.style.top=(s.pageY-t.top-e.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",e.style.left=(s.pageX-t.left-e.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return e.style.backgroundColor=l.color,e.className="waves-ripple z-active",!1}}return t[n]?t[n].removeHandle=s:t[n]={removeHandle:s},s}var i={bind(t,e){t.addEventListener("click",l(t,e),!1)},update(t,e){t.removeEventListener("click",t[n].removeHandle,!1),t.addEventListener("click",l(t,e),!1)},unbind(t){t.removeEventListener("click",t[n].removeHandle,!1),t[n]=null,delete t[n]}};const a=function(t){t.directive("waves",i)};window.Vue&&(window.waves=i,Vue.use(a)),i.install=a;var r=i},57801:function(t,e,s){s(57658),s(30541);var n=s(42325);function l(t,e=0,s="id",i="pid",a="children",r=null){const o=[];return t&&t.forEach((c=>{if(c[i]===e){null!==r&&(c=(0,n.hq)(c,r));const e=l(t,c[s],s,i,a,r);e.length&&(c[a]=e),o.push(c)}})),o}function i(t,e,s="id",n="pid"){let l=[];return t&&t.forEach((a=>{if(a[s]===e){l.unshift(a[n]);const e=i(t,a[n],s,n);e.length&&(l=l.concat(e))}})),l}function a(t,e,s,l){return t&&t.map((t=>{t[e]===s?(0,n.hq)(t,l):a(t.children,e,s,l)})),t}const r={listToTreeMulti:l,getParentsId:i,upadteArr:a};e["Z"]=r}}]);